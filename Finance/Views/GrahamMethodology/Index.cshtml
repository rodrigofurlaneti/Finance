@using Finance.Domain;
@model IEnumerable<Graham>

<link href="~/css/Views/GrahamMethodology.css" rel="stylesheet" />

<h1 class="text-center display-4">Fórmula de Benjamin Graham</h1>
<p>A Fórmula de Benjamin Graham é uma metodologia usada para avaliar se uma ação está subvalorizada, com base nos princípios de investimento em valor. Graham foi um pioneiro no campo do investimento em valor, e sua fórmula é amplamente utilizada por investidores para estimar o valor intrínseco de uma ação.</p>

<h2>Fórmula de Benjamin Graham</h2>
<p>A fórmula original de Benjamin Graham para calcular o valor intrínseco de uma ação é:</p>
<pre>
    V = (EPS * (8.5 + 2g) * 4.4) / Y
</pre>
<p>Onde:</p>
<ul>
    <li><strong>V</strong> = Valor Intrínseco</li>
    <li><strong>EPS</strong> = Lucro por Ação (Earnings Per Share)</li>
    <li><strong>8.5</strong> = Constante representando o múltiplo P/E apropriado para uma empresa sem crescimento</li>
    <li><strong>g</strong> = Taxa de Crescimento esperada dos lucros nos próximos 7-10 anos</li>
    <li><strong>4.4</strong> = Taxa de retorno do título AAA em 1962, quando Graham desenvolveu esta fórmula</li>
    <li><strong>Y</strong> = Taxa de retorno atual do título AAA</li>
</ul>

<h2>Versão Simplificada e Atualizada</h2>
<p>Devido à variação nas taxas de juros ao longo dos anos, muitos investidores usam uma versão simplificada da fórmula de Graham, considerando uma taxa de retorno fixa para simplificação:</p>
<pre>
    V = EPS * (8.5 + 2g)
</pre>

<h2>Passos para Calcular a Fórmula de Graham</h2>
<ol>
    <li>
        <strong>Identificar o EPS (Lucro por Ação):</strong>
        <p>Verifique o EPS dos últimos 12 meses. Esta informação está disponível nos relatórios financeiros da empresa ou em plataformas financeiras.</p>
    </li>
    <li>
        <strong>Determinar a Taxa de Crescimento (g):</strong>
        <p>Estime a taxa de crescimento anual dos lucros da empresa para os próximos 7-10 anos. Essa estimativa pode ser baseada em análises de mercado, projeções de analistas e desempenho histórico da empresa.</p>
    </li>
    <li>
        <strong>Aplicar a Fórmula:</strong>
        <p>Use os valores de EPS e g na fórmula para calcular o valor intrínseco.</p>
    </li>
</ol>

<h2>Exemplo Prático</h2>
<p>Suponha que você esteja avaliando a empresa XYZ S.A.:</p>
<ul>
    <li>EPS (Lucro por Ação): R$ 5,00</li>
    <li>Taxa de Crescimento (g): 6% ao ano</li>
</ul>
<p>Aplicando a fórmula simplificada de Graham:</p>
<pre>
    V = 5 * (8.5 + 2 * 6)
    V = 5 * (8.5 + 12)
    V = 5 * 20.5
    V = R$ 102.50
</pre>
<p>Isso significa que, de acordo com a fórmula de Graham, o valor intrínseco da ação é R$ 102.50. Se o preço de mercado atual da ação for inferior a esse valor, pode ser considerado subvalorizado e, portanto, uma potencial oportunidade de investimento.</p>

<h2>Considerações Importantes</h2>
<ul>
    <li><strong>Estimativas e Projeções:</strong> A precisão das estimativas de crescimento e lucro é crucial. Projeções excessivamente otimistas ou pessimistas podem distorcer o valor intrínseco calculado.</li>
    <li><strong>Contexto do Mercado:</strong> Considere o contexto econômico e setorial ao aplicar a fórmula, pois fatores externos podem impactar significativamente o desempenho futuro da empresa.</li>
    <li><strong>Diversificação:</strong> Mesmo que uma ação pareça subvalorizada, é importante diversificar seus investimentos para mitigar riscos.</li>
</ul>

<h2>Referências e Ferramentas Úteis</h2>
<ul>
    <li><a href="https://www.investopedia.com/terms/b/benjamingraham.asp">Benjamin Graham - Investopedia</a></li>
    <li><a href="https://www.statusinvest.com.br">Aplicação da Fórmula de Graham - Status Invest</a></li>
    <li><a href="https://www.fundamentus.com.br">Relatórios Financeiros - Fundamentus</a></li>
</ul>

<h5>Taxa de Crescimento (g): 7,00%.</h5>
<p>A média da Taxa de Crescimento esperada dos lucros nos próximos anos pode variar amplamente dependendo do setor, das condições econômicas gerais, e das características específicas da empresa. Contudo, uma média comum utilizada para muitos cálculos financeiros é cerca de 6% a 7% ao ano, considerando o mercado de ações dos Estados Unidos como referência histórica.</p>
<p>No entanto, na Fórmula de Benjamin Graham, é comum ver uma taxa de crescimento mais conservadora.No seu exemplo, foi usada uma taxa de crescimento anual de 7,00%.</p>
<p>Para ter uma ideia mais precisa, seria necessário analisar o setor específico e as projeções de crescimento dos analistas para as empresas que você está avaliando.</p>
<p>Se você está tentando calcular uma média da Taxa de Crescimento esperada dos lucros para um conjunto de empresas específicas, você pode fazer isso da seguinte maneira:</p>
<p>Colete os dados de crescimento esperado para cada empresa.</p>
<p>Calcule a média dessas taxas de crescimento.</p>

<h5>Taxa de retorno atual do título (Y): 1,55%</h5>
<p>A taxa de retorno atual de um título AAA pode variar conforme o mercado e o prazo do título.</p>
<p>Títulos AAA são considerados de alta qualidade e baixo risco, geralmente emitidos por governos ou grandes corporações com excelente saúde financeira.</p>
<p>Para determinar a taxa de retorno atual, você pode consultar fontes como agências de classificação de risco (Moody's, S&P, Fitch) ou mercados financeiros que fornecem essas informações em tempo real. Como não tenho acesso à internet para consultar a taxa atual, vou descrever um método geral para calcular a média da taxa de retorno de um conjunto de títulos AAA.</p>

<h2 class="text-center display-4">Ranking:</h2>

<h5 class="text-end" style="font-weight: 200;"><strong>Total de ativos, Ações, Bdrs e Fiis @Model.Count() localizados</strong></h5>

<h2>Filtrar</h2>
<input type="text" id="filtroInput" onkeyup="filtrarTabela()" placeholder="Digite para filtrar...">

<h2>Opções</h2>
<button id="filtroOrderByKindBdr" name="filtroOrderByKindBdr" class="btn btn-primary btn-sm">Bdr</button>
<button id="filtroOrderByKindFii" name="filtroOrderByKindFii" class="btn btn-primary btn-sm">Fii</button>
<button id="filtroOrderByKindStock" name="filtroOrderByKindStock" class="btn btn-primary btn-sm">Stock</button>

<div class="btn-group" role="group" aria-label="Basic example">
    <button type="button" id="ordenarPorYieldDesc" name="ordenarPorYieldDesc" class="btn btn-primary btn-sm">
        <i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i>
    </button>
    <button type="button" class="btn btn-primary btn-sm">Yield</button>
    <button type="button" id="ordenarPorYieldAsc" name="ordenarPorYieldAsc" class="btn btn-primary btn-sm">
        <i class="fa-solid fa-arrow-down fa-fw" aria-hidden="true"></i>
    </button>
</div>

<div class="btn-group" role="group" aria-label="Basic example">
    <button type="button" id="ordenarPorPriceDesc" name="ordenarPorPriceDesc" class="btn btn-primary btn-sm">
        <i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i>
    </button>
    <button type="button" class="btn btn-primary btn-sm">Preço</button>
    <button type="button" id="ordenarPorPriceAsc" name="ordenarPorPriceAsc" class="btn btn-primary btn-sm">
        <i class="fa-solid fa-arrow-down fa-fw" aria-hidden="true"></i>
    </button>
</div>

<div class="btn-group" role="group" aria-label="Basic example">
    <button type="button" id="ordenarPorResultDesc" name="ordenarPorResultDesc" class="btn btn-primary btn-sm">
        <i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i>
    </button>
    <button type="button" class="btn btn-primary btn-sm">Resultado</button>
    <button type="button" id="ordenarPorResultAsc" name="ordenarPorResultAsc" class="btn btn-primary btn-sm">
        <i class="fa-solid fa-arrow-down fa-fw" aria-hidden="true"></i>
    </button>
</div>

<button id="cleanModel" name="cleanModel" class="btn btn-primary btn-sm">Limpar Filtros</button>

<div id="tabelaContainer">

    @Html.Partial("_TabelaGraham", Model)

</div>

<script>

    function filtrarTabela() {
        var input, filter, table, tr, td, i, j, txtValue;
        input = document.getElementById("filtroInput");
        filter = input.value.toUpperCase();
        table = document.getElementById("minhaTabela");
        tr = table.getElementsByTagName("tr");

        for (i = 1; i < tr.length; i++) {
            tr[i].style.display = "none";
            td = tr[i].getElementsByTagName("td");
            for (j = 0; j < td.length; j++) {
                if (td[j]) {
                    txtValue = td[j].textContent || td[j].innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                        break;
                    }
                }
            }
        }
    }

    var model = @Html.Raw(Json.Serialize(Model));

    function updateModelAndRender(url) {
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(model)
        })
            .then(response => response.json())
            .then(updatedModel => {
                model = updatedModel; // Atualize o modelo com a resposta do servidor
                renderTable(model);
            })
            .catch(error => console.error('Error:', error));
    }

    function renderTable(updatedModel) {
        fetch('/GrahamMethodology/RenderTable', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updatedModel)
        })
            .then(response => response.text())
            .then(html => {
                document.getElementById("tabelaContainer").innerHTML = html;
            })
            .catch(error => console.error('Error:', error));
    }

    function cleanModelAndRender() {
        fetch('/GrahamMethodology/Clean')
            .then(response => response.json())
            .then(cleanedModel => {
                model = cleanedModel; // Atualize o modelo com o modelo limpo
                renderTable(model);
            })
            .catch(error => console.error('Error:', error));
    }

    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("ordenarPorYieldAsc").addEventListener("click", function () {
            updateModelAndRender('/GrahamMethodology/OrderByAscendingYield');
        });

        document.getElementById("ordenarPorYieldDesc").addEventListener("click", function () {
            updateModelAndRender('/GrahamMethodology/OrderByDescendingYield');
        });

        document.getElementById("filtroOrderByKindFii").addEventListener("click", function () {
            updateModelAndRender('/GrahamMethodology/OrderByKindFii');
        });

        document.getElementById("filtroOrderByKindStock").addEventListener("click", function () {
            updateModelAndRender('/GrahamMethodology/OrderByKindStock');
        });

        document.getElementById("filtroOrderByKindBdr").addEventListener("click", function () {
            updateModelAndRender('/GrahamMethodology/OrderByKindBdr');
        });

        document.getElementById("ordenarPorResultAsc").addEventListener("click", function () {
            updateModelAndRender('/GrahamMethodology/OrderByAscendingResult');
        });

        document.getElementById("ordenarPorResultDesc").addEventListener("click", function () {
            updateModelAndRender('/GrahamMethodology/OrderByDescendingResult');
        });

        document.getElementById("ordenarPorPriceAsc").addEventListener("click", function () {
            updateModelAndRender('/GrahamMethodology/OrderByAscendingPrice');
        });

        document.getElementById("ordenarPorPriceDesc").addEventListener("click", function () {
            updateModelAndRender('/GrahamMethodology/OrderByDescendingPrice');
        });

        document.getElementById("cleanModel").addEventListener("click", function () {
            cleanModelAndRender();
        });
    });
</script>
